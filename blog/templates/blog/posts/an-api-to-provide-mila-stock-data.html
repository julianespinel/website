<p>{% extends 'blog/base.html' %}<br />
{% load static %}<br />
{% block content %}</p>
<h1>An API to provide MILA stock data</h1>
<p>Around five years ago, I was structuring my undergraduate thesis around performing heuristic-based analysis over the US stock market. At that time I asked myself the following question: “Given I live in Colombia, can I perform heuristic-based analysis using data from the Colombian stock market?” The answer was simple: the dataset of stocks in Colombia was so small, that it was not worth it. The Colombian stock exchange had 80 companies listed, while the US stock market had +6000 stocks only in NYSE and NASDAQ.</p>
<p>By the beginning of 2018, after monitoring and investing in the US stock market for some time, creating systems to <a href="https://github.com/julianespinel/stockreader">gather US stock market data</a> and performing analysis over that information; the question came into my mind again: “Given that I live in Colombia, can I perform analysis using data from the Colombian stock market?”, and this time I hoped the answer would be different because now MILA was in place.</p>
<h2>What is MILA?</h2>
<p>The Integrated Latin American Exchange known as <a href="https://en.wikipedia.org/wiki/Mercado_Integrado_Latinoamericano">MILA</a> for its initials in Spanish, is a cooperative initiative that integrates stock markets from Mexico, Colombia, Chile and Peru. MILA started operating in 2011 with three founding members: Colombia, Chile and Peru. Mexico became part of MILA by 2014, making it an exchange with more than 700 listed companies.</p>
<h2>MILA API</h2>
<p>Data is the main resource you need in order to perform stock market analysis, specifically historical data; and now it seems we have enough information thanks to MILA. This takes us to a critical step of the analysis process: acquiring information. The US stock market excels at this point because you can find historical stock data in multiple websites such as Yahoo Finance, Google Finance and Quandl, just to name a few. Most of them offer an API to access information and it’s open to the general public.</p>
<p>Taking those websites as inspiration I decided to start creating <a href="https://github.com/julianespinel/mila-api">MILA API</a>, an API to provide MILA stock market data. To simplify the problem I decided to begin the project by offering an API that returns closing data from the previous trading day.</p>
<h2>Design</h2>
<p>In general terms, I needed to gather previous day stock data from all four MILA members (Mexico, Colombia, Chile and Peru), store it into a database and expose it using an HTTP API. As I began looking for current day stock market data from Mexico, Colombia, Chile and Peru, I realized there were not websites like Yahoo Finance or Quandl that provide stock data for Latin American exchanges. The lack of a central point where to obtain data from, meant I would have to gather information from each stock exchange individually.</p>
<p>Considering that constraint, my idea was to obtain information from each stock market part of MILA once a day. I would have to perform at least four external requests in order to get the previous day stock data. In the diagram below I show the design of the piece of software created to gather stock data and then offer it through an API.</p>
<p><img alt="MILA api_uml" src="{% static 'blog/mila_api.png' %}" /></p>
<p>The design was simple, I built an architecture composed of three main layers:</p>
<ol>
<li><strong>API</strong>: responsible for verifying the input sent in the HTTP requests and serializing the response to be given to the user.</li>
<li><strong>Domain</strong>: responsible for handling the business logic. Part of the business logic is to gather data once a day from each stock exchange.</li>
<li><strong>Persistence</strong>: responsible for communicating with the database. Specifically, it performs CRUD operations of stock data against the database.</li>
</ol>
<p>There are four clients on the right-hand side of the diagram, each client is responsible for getting stock market data from each stock exchange part of MILA and return that data to the domain layer in the form of business objects.</p>
<h2>Implementation</h2>
<p>The implementation of MILA API is not complete yet. It currently downloads stock market data from the Colombian stock exchange, transforms it into valid business objects and stores them in the database. Then it exposes the information using an HTTP API.</p>
<p>Here is an example of an endpoint request and its response:</p>
<p>Request:</p>
<pre class="highlight"><code>GET mila/api/colombia</code></pre>


<p>Response:</p>
<pre class="highlight"><code>{
  &quot;date&quot;: &quot;2018-05-26T10:03:58.813141778-05:00&quot;,
  &quot;country&quot;: &quot;colombia&quot;,
  &quot;stocksData&quot;: [
    {
      &quot;date&quot;: &quot;2018-05-26T10:03:58.812629133-05:00&quot;,
      &quot;country&quot;: &quot;colombia&quot;,
      &quot;symbol&quot;: &quot;BCOLOMBIA&quot;,
      &quot;name&quot;: &quot;Bancolombia&quot;,
      &quot;currency&quot;: &quot;COP&quot;,
      &quot;open&quot;: &quot;33000&quot;,
      &quot;high&quot;: &quot;35100&quot;,
      &quot;low&quot;: &quot;32900&quot;,
      &quot;close&quot;: &quot;33200&quot;,
      &quot;adjClose&quot;: &quot;33200&quot;,
      &quot;volume&quot;: 891338
    },
    {
      &quot;date&quot;: &quot;2018-05-26T10:03:58.812713643-05:00&quot;,
      &quot;country&quot;: &quot;colombia&quot;,
      &quot;symbol&quot;: &quot;GRUPOARGOS&quot;,
      &quot;name&quot;: &quot;Grupo Argos&quot;,
      &quot;currency&quot;: &quot;COP&quot;,
      &quot;open&quot;: &quot;19700&quot;,
      &quot;high&quot;: &quot;21300&quot;,
      &quot;low&quot;: &quot;19500&quot;,
      &quot;close&quot;: &quot;20000&quot;,
      &quot;adjClose&quot;: &quot;20000&quot;,
      &quot;volume&quot;: 373137
    }
  ]
}</code></pre>


<p>The part missing for the project to be complete is to create the clients responsible for gathering market information from the remaining countries: MexicoClient, ChileClient and PeruClient.</p>
<p>The code is available <a href="https://github.com/julianespinel/mila-api">here</a>.</p>
<h2>Lessons learned</h2>
<p>By doing this side project I learned new technical implementation details related to the Go programming language, here I list them:</p>
<ol>
<li><code>dep</code> is a great dependency management tool, simple to use. Here is an <a href="https://golang.github.io/dep/docs/daily-dep.html">overview</a>.</li>
<li>How to use <code>go-vcr</code> to record HTTP requests for testing. Here is an <a href="https://github.com/julianespinel/mila-api/blob/c8fa9e8e46d0b66d41acaad52330722b3b68144c/bvc/client_test.go#L14-L27">example</a>.</li>
<li>How to use <code>gomock</code> to create mocks and use them in tests. Here is an <a href="https://github.com/julianespinel/mila-api/blob/f0a12e5b50c950a36c0b51a4b0bc1813fc7b116a/core/domain_test.go#L29-L30">example</a>.</li>
<li>Although I try to avoid ORMs, this time I used <code>gorm</code> because MILA API was a small and simple project. Gorm helped me to reduce the time writing database access code significantly. Here are some examples: <a href="https://github.com/julianespinel/mila-api/blob/a0a7f14e8697478f9c4458392c570b29e3d1ca74/models/stock.go#L11-L14">one</a> and <a href="https://github.com/julianespinel/mila-api/blob/f0a12e5b50c950a36c0b51a4b0bc1813fc7b116a/core/persistence.go">two</a>.</li>
<li>Iris (the web framework) is fast, flexible and simple to use. Here is an <a href="https://github.com/julianespinel/mila-api/blob/1777c037212b5dcc1e44267253f026530fe3e058/main.go#L60-L68">example</a>.</li>
</ol>
<h2>Next steps</h2>
<p>I don’t know if I will finish this project, but the road until this point has been fun. The project still requires <a href="https://github.com/julianespinel/mila-api/issues">some work</a> and I don’t know if I will use it once it is finished. The primary goal of MILA API was to check if this time I could have a better answer (with respect of the one I had five years ago) to the question: “Given I live in Colombia, can I perform analysis using data from the Colombian stock market?”.</p>
<p>This time the answer was indeed better, now we have enough data and enough companies listed in MILA to be able to perform automated analysis on them. At this moment the problem is different, we have data but we lack the infrastructure to make that data available. Latin America is still behind in terms of financial services that provide access to stock market data to the general public.</p>
<p>A secondary goal I was pursuing when I started this project was to learn a more about Golang. The fact that Golang has a small syntax, one way to do things, and a <a href="https://blog.golang.org/go-fmt-your-code">clearly defined code style</a>; means it will be easier to read and maintain by other people. Taking into consideration that most of the software lifecycle is spent on maintenance, this aspect of a programming language is crucial for me. I’m not an expert in Golang, but this project allowed me to practice and appreciate the Go programming language.</p>
<p>{% endblock %}</p>